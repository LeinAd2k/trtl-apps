<div class="page-content">
  <mat-card class="y-spacer">
    <mat-card-content>
      <mat-card-title class="page-title">Webhooks</mat-card-title>
      <div class="section-spacer"></div>
      <p>
        Webhooks are a way for your app to receive notifications of backend events as they happen. To receive these notifications
        you can set a webhook URL for your app in the console. When a new event occurs, a <span class="code-block">POST</span> request
        is sent to the webhook URL. Each event type has a unique code, and a data property containing the event details.
      </p>
      <p>
        The backend expects a 2xx response code to indicate that the notification was received. In the event of failure,
        the backend will retry the sending the event a few times in larger time intervals.
      </p>
      <div class="section-spacer"></div>
      <mat-card-title>Validating payloads from TRTL apps</mat-card-title>
      <p>
        TRTL apps uses your app secret to create a hash signature with each payload.
        This hash signature is passed along with each request in the headers as <span class="code-block">x-trltapps-signature</span>.
      </p>
      <p>
        To validate a request, compute a hash using your APP_SECRET, and ensure that the hash from the request header matches. TRTL apps
        uses a HMAC hexdigest to compute the hash. An example validation function in node.js using the <span class="code-block">crypto</span> module:
      </p>
      <pre class="code-block">
        const hash = 'sha256=' + crypto
                      .createHmac("sha256", 'YOUR_APP_SECRET')
                      .update(JSON.stringify(request.body))
                      .digest("hex");

        const isValid = hash === requestSignature;

        return isValid;
      </pre>
      <p>
        Your language and server implementations may differ than this code, however no matter which implementation
        you use, the hash signature starts with <span class="code-block">sha256=</span>, using
        your app secret token and the payload body.
      </p>
      <div class="section-spacer"></div>
      <mat-card-title>Examples</mat-card-title>
      <p>
        Below the different event types are listed along with example payloads.
      </p>
      <h2>New deposit</h2>
      <p>
        This event is sent when a new user deposit is detected. New deposits start with a <span class="code-block">confirming</span>
        status while we wait for block confirmations.
      </p>
      <div class="code-block">
        <pre>{{ depositConfirming | json }}</pre>
      </div>
      <h2>Deposit succeeded</h2>
      <p>
        Once the deposit has been confirmed, the user's balance is credited with the deposit amount and the deposit succeeded
        event is sent.
      </p>
      <div class="code-block">
        <pre>{{ depositSucceeded | json }}</pre>
      </div>
      <h2>Deposit cancelled</h2>
      <p>
        In the case where the deposit transaction was not confirmed in the blockchain, the deposit is marked as failed
        and the deposit cancelled event will be fired.
      </p>
      <div class="code-block">
        <pre>{{ depositCancelled | json }}</pre>
      </div>
      <h2>Withdrawal succeeded</h2>
      <p>
        This event is sent when a user withdrawal has been successfully processed.
      </p>
      <div class="code-block">
        <pre>{{ withdrawalSucceeded | json }}</pre>
      </div>
      <h2>Withdrawal failed</h2>
      <p>
        In the case where a user withdrawal was not processed succesfully, the user's balance will be reimbursement
        with the amount and the withdrawal failed event is sent.
      </p>
      <div class="code-block">
        <pre>{{ withdrawalFailed | json }}</pre>
      </div>
      <div class="section-spacer"></div>
    </mat-card-content>
  </mat-card>
</div>
